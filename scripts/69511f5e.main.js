(function(){"use strict";var a,b,c,d={host:"https://sailfish.io",publicAccessKey:void 0,privateAccessKey:void 0,apiVersion:"v1",authLevel:"APP",prefix:"Sailfish",defer:$.Deferred},e={};b=function(){},b.prototype={signIn:function(){},signOut:function(){},signUp:function(){},update:function(){},exists:function(){},forgotPassword:function(){},resetPassword:function(){},info:function(){},isSignedIn:function(){},isGuest:function(){},isRegistered:function(){}},c=function(){},a=function(a){if(this.config=d,"object"!=typeof a)throw"Argument is not a object";if(!a.publicAccessKey)throw"No publicAccessKey";if(!a.privateAccessKey)throw"No privateAccessKey";this.config.publicAccessKey=a.publicAccessKey,this.config.privateAccessKey=a.privateAccessKey,a.host&&(this.config.host=a.host),a.apiVersion&&(this.config.apiVersion=a.apiVersion),a.authLevel&&(this.config.authLevel=a.authLevel),a.prefix&&(this.config.prefix=a.prefix),a.defer&&"function"==typeof a.defer&&(this.config.defer=a.defer);var b=this;this.page=1,this.perPage=20,this.totalPages=1;var c=function(a){var c=this;this.slug=a,this.app=b,this.page=1,this.perPage=20,this.totalPages=1,this.attributes=null,this.initializeAttributes();var d=function(a){a&&$.extend(this,a),this.collection=c;var b=this;this.collection.fields().then(function(a){b.fields=a})};d.prototype={save:function(){var a=this,b=new this.collection.app.config.defer;return this.getFields().then(function(c){var d=a.extractContent(c),e="dynamic/collections/"+a.collection.slug+"/entities/";return a.newRecord()?(delete a.id,a.collection.app.post(e,{data:{entity:d}}).then(function(c){a.id=c.data.id,b.resolve(c)},function(a){b.reject(a)})):(e+=a.id,void a.collection.app.put(e,{data:{entity:d}}).then(function(a){b.resolve(a)},function(a){b.reject(a)}))},function(){throw"No data, can't save"}),"function"==typeof b.promise?b.promise():b.promise},remove:function(){if(this.newRecord())throw"New Record, can't delete";var a="dynamic/collections/"+this.collection.slug+"/entities/"+this.id,b=new this.collection.app.config.defer;return this.collection.app.remove(a).then(function(a){b.resolve(a)},function(a){b.reject(a)}),"function"==typeof b.promise?b.promise():b.promise},extractContent:function(a){for(var b={},c=0;c<a.length;c++)b[a[c]]=this[a[c]];return b},newRecord:function(){return!this.id||"string"!=typeof this.id},getFields:function(){var a=new this.collection.app.config.defer;return this.fields?a.resolve(this.fields):this.collection.fields(),"function"==typeof a.promise?a.promise():a.promise}},this.Entity=d};c.prototype={fullTextSearch:function(a,b,c){var d="dynamic/collections/"+this.slug+"/entities/full_text_search",e=this,f=new this.app.config.defer;return this.app.get(d,{data:{q:a}}).then(function(a){e.totalPages=a.meta.total_pages,e.meta=a.meta,f.resolve(e.initializeAsEntities(a.data))},function(a){f.reject(a.errors)}),"function"==typeof f.promise?f.promise():f.promise},search:function(a){if("object"!=typeof a)throw"Query should be a JSON Object";var b="dynamic/collections/"+this.slug+"/entities/search",c=this,d=new this.app.config.defer;return this.app.post(b,{data:a}).then(function(a){c.totalPages=a.meta.total_pages,c.page=a.meta.page,c.perPage=a.meta.per_page,c.meta=a.meta,d.resolve(c.initializeAsEntities(a.data))},function(a){d.reject(a.errors)}),"function"==typeof d.promise?d.promise():d.promise},find:function(a){var b="dynamic/collections/"+this.slug+"/entities/"+a,c=new this.app.config.defer,d=this;return this.app.get(b).then(function(a){c.resolve(new d.Entity(a.data))},function(a){c.reject(a.errors)}),"function"==typeof c.promise?c.promise():c.promise},all:function(a,b){a&&(this.page=1),b&&(this.perPage=20);var c="dynamic/collections/"+this.slug+"/entities",d=new this.app.config.defer,e=this;return this.app.get(c,{data:{page:a,per_page:b}}).then(function(a){e.totalPages=a.meta.total_pages,e.meta=a.meta,d.resolve(e.initializeAsEntities(a.data))},function(a){d.reject(a.errors)}),"function"==typeof d.promise?d.promise():d.promise},info:function(){var a="dynamic/collections/"+this.slug;return this.app.get(a)},initializeAsEntities:function(a){var b=[];if(!a)return b;for(var c=0;c<a.length;c++)b.push(new this.Entity(a[c]));return b},fields:function(){var a=this,b=function(){for(var b=[],c=0;c<a.attributes.length;c++)b.push(a.attributes[c].slug);return b},c=new this.app.config.defer;return this.attributes&&this.attributes.length>=0?c.resolve(b()):this.initializeAttributes().then(function(){c.resolve(b())}),"function"==typeof c.promise?c.promise():c.promise},initializeAttributes:function(){var a=this,b="dynamic/collections/"+this.slug+"/attributes";return this.app.get(b).then(function(b){a.attributes=b.data})}},this.Collection=c},a.prototype={collection:function(a){return new this.Collection(a)},collections:function(a,b){a&&(this.page=a),b&&(this.perPage=b);var c=new this.config.defer,d=this;return this.get("dynamic/collections",{data:{page:this.page,per_page:this.perPage}}).then(function(a){for(var b=[],e=0;e<a.data.length;e++)b.push(new d.Collection(a.data[e].slug));d.totalPages=a.meta.total_pages,c.resolve(b)},function(a){c.reject(a)}),"function"==typeof c.promise?c.promise():c.promise},info:function(){return this.get("dynamic/apps/info")},get:function(a,b){return this.basicRequest(a,"GET",b)},post:function(a,b){return this.basicRequest(a,"POST",b)},remove:function(a,b){return this.basicRequest(a,"DELETE",b)},put:function(a,b){return this.basicRequest(a,"PUT",b)},basicRequest:function(a,b,c){var d=this.httpDate(),a=this.buildUrl(a),e=this.config.host+a,f=this.generateAuthentication(d,a,b),g={type:b,url:e,headers:{AUTH_LEVEL:this.config.authLevel,AUTHENTICATION:f,TIMESTAMP:d}},h=$.extend({},g,c);return $.ajax(h)},httpDate:function(){return(new Date).toUTCString()},generateAuthentication:function(a,b,c){var d=[c,b,a].join(";"),e=CryptoJS.HmacSHA256(d,this.config.privateAccessKey).toString(CryptoJS.enc.Base64);return[this.config.prefix,this.config.publicAccessKey,e].join(":")},buildUrl:function(a){return a&&0!==a.indexOf("/")&&(a="/"+a),"/api/"+this.config.apiVersion+a}},e={App:a};var f={function:!0,object:!0},g=f[typeof window]&&window||this;g.Sailfish=e}).call(this);var CryptoJS=CryptoJS||function(a,b){var c={},d=c.lib={},e=d.Base=function(){function a(){}return{extend:function(b){a.prototype=this;var c=new a;return b&&c.mixIn(b),c.hasOwnProperty("init")||(c.init=function(){c.$super.init.apply(this,arguments)}),c.init.prototype=c,c.$super=this,c},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),f=d.WordArray=e.extend({init:function(a,c){a=this.words=a||[],c!=b?this.sigBytes=c:this.sigBytes=4*a.length},toString:function(a){return(a||h).stringify(this)},concat:function(a){var b=this.words,c=a.words,d=this.sigBytes,e=a.sigBytes;if(this.clamp(),d%4)for(var f=0;f<e;f++){var g=c[f>>>2]>>>24-f%4*8&255;b[d+f>>>2]|=g<<24-(d+f)%4*8}else if(c.length>65535)for(var f=0;f<e;f+=4)b[d+f>>>2]=c[f>>>2];else b.push.apply(b,c);return this.sigBytes+=e,this},clamp:function(){var b=this.words,c=this.sigBytes;b[c>>>2]&=4294967295<<32-c%4*8,b.length=a.ceil(c/4)},clone:function(){var a=e.clone.call(this);return a.words=this.words.slice(0),a},random:function(b){for(var c=[],d=0;d<b;d+=4)c.push(4294967296*a.random()|0);return new f.init(c,b)}}),g=c.enc={},h=g.Hex={stringify:function(a){for(var b=a.words,c=a.sigBytes,d=[],e=0;e<c;e++){var f=b[e>>>2]>>>24-e%4*8&255;d.push((f>>>4).toString(16)),d.push((15&f).toString(16))}return d.join("")},parse:function(a){for(var b=a.length,c=[],d=0;d<b;d+=2)c[d>>>3]|=parseInt(a.substr(d,2),16)<<24-d%8*4;return new f.init(c,b/2)}},i=g.Latin1={stringify:function(a){for(var b=a.words,c=a.sigBytes,d=[],e=0;e<c;e++){var f=b[e>>>2]>>>24-e%4*8&255;d.push(String.fromCharCode(f))}return d.join("")},parse:function(a){for(var b=a.length,c=[],d=0;d<b;d++)c[d>>>2]|=(255&a.charCodeAt(d))<<24-d%4*8;return new f.init(c,b)}},j=g.Utf8={stringify:function(a){try{return decodeURIComponent(escape(i.stringify(a)))}catch(a){throw new Error("Malformed UTF-8 data")}},parse:function(a){return i.parse(unescape(encodeURIComponent(a)))}},k=d.BufferedBlockAlgorithm=e.extend({reset:function(){this._data=new f.init,this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=j.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(b){var c=this._data,d=c.words,e=c.sigBytes,g=this.blockSize,h=4*g,i=e/h;i=b?a.ceil(i):a.max((0|i)-this._minBufferSize,0);var j=i*g,k=a.min(4*j,e);if(j){for(var l=0;l<j;l+=g)this._doProcessBlock(d,l);var m=d.splice(0,j);c.sigBytes-=k}return new f.init(m,k)},clone:function(){var a=e.clone.call(this);return a._data=this._data.clone(),a},_minBufferSize:0}),l=(d.Hasher=k.extend({cfg:e.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){k.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){a&&this._append(a);var b=this._doFinalize();return b},blockSize:16,_createHelper:function(a){return function(b,c){return new a.init(c).finalize(b)}},_createHmacHelper:function(a){return function(b,c){return new l.HMAC.init(a,c).finalize(b)}}}),c.algo={});return c}(Math);!function(){var a=CryptoJS,b=a.lib,c=b.WordArray,d=a.enc;d.Base64={stringify:function(a){var b=a.words,c=a.sigBytes,d=this._map;a.clamp();for(var e=[],f=0;f<c;f+=3)for(var g=b[f>>>2]>>>24-f%4*8&255,h=b[f+1>>>2]>>>24-(f+1)%4*8&255,i=b[f+2>>>2]>>>24-(f+2)%4*8&255,j=g<<16|h<<8|i,k=0;k<4&&f+.75*k<c;k++)e.push(d.charAt(j>>>6*(3-k)&63));var l=d.charAt(64);if(l)for(;e.length%4;)e.push(l);return e.join("")},parse:function(a){var b=a.length,d=this._map,e=d.charAt(64);if(e){var f=a.indexOf(e);f!=-1&&(b=f)}for(var g=[],h=0,i=0;i<b;i++)if(i%4){var j=d.indexOf(a.charAt(i-1))<<i%4*2,k=d.indexOf(a.charAt(i))>>>6-i%4*2;g[h>>>2]|=(j|k)<<24-h%4*8,h++}return c.create(g,h)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(){var a=CryptoJS,b=a.lib,c=b.Base,d=a.enc,e=d.Utf8,f=a.algo;f.HMAC=c.extend({init:function(a,b){a=this._hasher=new a.init,"string"==typeof b&&(b=e.parse(b));var c=a.blockSize,d=4*c;b.sigBytes>d&&(b=a.finalize(b)),b.clamp();for(var f=this._oKey=b.clone(),g=this._iKey=b.clone(),h=f.words,i=g.words,j=0;j<c;j++)h[j]^=1549556828,i[j]^=909522486;f.sigBytes=g.sigBytes=d,this.reset()},reset:function(){var a=this._hasher;a.reset(),a.update(this._iKey)},update:function(a){return this._hasher.update(a),this},finalize:function(a){var b=this._hasher,c=b.finalize(a);b.reset();var d=b.finalize(this._oKey.clone().concat(c));return d}})}(),function(a){var b=CryptoJS,c=b.lib,d=c.WordArray,e=c.Hasher,f=b.algo,g=[],h=[];!function(){function b(b){for(var c=a.sqrt(b),d=2;d<=c;d++)if(!(b%d))return!1;return!0}function c(a){return 4294967296*(a-(0|a))|0}for(var d=2,e=0;e<64;)b(d)&&(e<8&&(g[e]=c(a.pow(d,.5))),h[e]=c(a.pow(d,1/3)),e++),d++}();var i=[],j=f.SHA256=e.extend({_doReset:function(){this._hash=new d.init(g.slice(0))},_doProcessBlock:function(a,b){for(var c=this._hash.words,d=c[0],e=c[1],f=c[2],g=c[3],j=c[4],k=c[5],l=c[6],m=c[7],n=0;n<64;n++){if(n<16)i[n]=0|a[b+n];else{var o=i[n-15],p=(o<<25|o>>>7)^(o<<14|o>>>18)^o>>>3,q=i[n-2],r=(q<<15|q>>>17)^(q<<13|q>>>19)^q>>>10;i[n]=p+i[n-7]+r+i[n-16]}var s=j&k^~j&l,t=d&e^d&f^e&f,u=(d<<30|d>>>2)^(d<<19|d>>>13)^(d<<10|d>>>22),v=(j<<26|j>>>6)^(j<<21|j>>>11)^(j<<7|j>>>25),w=m+v+s+h[n]+i[n],x=u+t;m=l,l=k,k=j,j=g+w|0,g=f,f=e,e=d,d=w+x|0}c[0]=c[0]+d|0,c[1]=c[1]+e|0,c[2]=c[2]+f|0,c[3]=c[3]+g|0,c[4]=c[4]+j|0,c[5]=c[5]+k|0,c[6]=c[6]+l|0,c[7]=c[7]+m|0},_doFinalize:function(){var b=this._data,c=b.words,d=8*this._nDataBytes,e=8*b.sigBytes;return c[e>>>5]|=128<<24-e%32,c[(e+64>>>9<<4)+14]=a.floor(d/4294967296),c[(e+64>>>9<<4)+15]=d,b.sigBytes=4*c.length,this._process(),this._hash},clone:function(){var a=e.clone.call(this);return a._hash=this._hash.clone(),a}});b.SHA256=e._createHelper(j),b.HmacSHA256=e._createHmacHelper(j)}(Math),function(a){var b=a("body"),c=function(){var c=b.width()/10,d=c-1,e=b.width();a(".triangle").css({"border-bottom-width":c.toString()+"px","border-left":e.toString()+"px solid transparent",top:"-"+d.toString()+"px"})},d=function(){var b=a(".iphone5s img"),c=.46*b.width(),d=.6248*b.height(),e=b.position().top+.1315*b.height(),f=b.position().left+.263*b.width();a(".iphone5s .video-container .video-js").css({width:c.toString()+"px",height:d.toString()+"px"}),a(".iphone5s .video-container").css({top:e.toString()+"px",left:f.toString()+"px"})};d(),a(window).on("resize",d),a(window).trigger("resize"),c(),a(window).on("resize",c);var e=new Sailfish.App({publicAccessKey:"KNFowUVKhDVpxU2LBYsH",privateAccessKey:"QWplsXzFj1vFvrU5qsqhPDgUUOHOOA2hZnsDnMDl"}),f=e.collection("videos"),g=e.collection("feedbacks");f.search({query:{slug:"introduction"}}).done(function(b){if(b.length>0){var c=b[0].file[0].url;a(".introduction-video-source").attr("src",c);videojs("introduction",{},function(){})}}),f.search({query:{slug:"operation"}}).done(function(b){if(b.length>0){var c=b[0].file[0].url;a(".operation-video-source").attr("src",c);videojs("operation",{},function(){})}}),a(".feedback-submit").on("click",function(b){b.preventDefault();var c=a(".feedback-content").val(),d=a(".feedback-name").val(),e=a(".feedback-contact").val(),f=function(){a(".feedback-content").val(""),a(".feedback-name").val(""),a(".feedback-contact").val("")};if(d&&c&&e){if(!(validator.isEmail(e)||e.length>=7&&validator.isNumeric(e)))return alert("请您填写正确的联系方式, 邮箱或者电话号码");if(d.length<=1)return alert("您的姓名可不能只填1个字哟");if(c.length<=5)return alert(" 求求你了，多写点建议嘛~~~");var h=new g.Entity;h.name=d,h.contact=e,h.content=c,h.save().done(function(a){alert("感谢您的建议，祝您生活愉快，万事如意！"),f()}).fail(function(a){alert("咦，好像没有保存成功~~~~")})}else alert("我知道要填写的内容有点多，但是您既然都已经决定要填了，那就请完善您的信息...")})}($);